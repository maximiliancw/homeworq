{% extends "base.html" %}
{% block title %}Tasks{% endblock %}

{% block page_menu %}
<div>
    <input type="search" x-model="searchQuery" placeholder="Search tasks..." aria-label="Search tasks">
</div>
{% endblock %}

{% block content %}
<div x-data="taskList()" x-init="init()" aria-label="Available Tasks">
    <template x-for="task in filteredTasks" :key="task.name">
        <section :id="'task-' + task.name" class="task-section" style="margin-top: 5rem;">
            <header style="display: flex; justify-content: space-between; align-items: center;">
                <h3 x-text="task.title || task.name"></h3>
                <div>
                    <kbd x-text="task.name"></kbd>
                </div>
            </header>
            <div style="margin-top: 1rem;">
                <pre x-text="task.description || 'No description available'"></pre>
            </div>
        </section>
    </template>
</div>

<script>
    function taskList() {
        return {
            tasks: [],
            searchQuery: '',

            get filteredTasks() {
                const query = this.searchQuery.toLowerCase();
                return this.tasks.filter(task =>
                    task.name.toLowerCase().includes(query) ||
                    (task.description && task.description.toLowerCase().includes(query)) ||
                    (task.title && task.title.toLowerCase().includes(query))
                );
            },

            async init() {
                const response = await fetch('/api/tasks');
                this.tasks = await response.json();
            }
        };
    }
</script>
{% endblock %}
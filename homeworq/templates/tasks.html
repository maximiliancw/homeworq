{% extends "base.html" %}
{% block title %}Tasks{% endblock %}

{% block page_menu %}
<div>
    <input type="search" x-model="searchQuery" placeholder="Search tasks..." aria-label="Search tasks">
</div>
{% endblock %}

{% block content %}
<div x-data="taskList()" aria-label="Available Tasks">
    <template x-for="task in filteredTasks" :key="task.name">
        <details :id="'task-' + task.name">
            <summary>
                <kbd x-text="task.name"></kbd>
                <span x-text="task.title" class="ml-8"></span>
            </summary>
            <div class="card-content">
                <pre x-text="task.description || 'No description available'"></pre>
            </div>
        </details>
    </template>
</div>

<script>
    function taskList() {
        return {
            tasks: [],
            searchQuery: '',

            get filteredTasks() {
                const query = this.searchQuery.toLowerCase();
                return this.tasks.filter(task =>
                    task.name.toLowerCase().includes(query) ||
                    task.description?.toLowerCase().includes(query) ||
                    task.title?.toLowerCase().includes(query)
                );
            },

            async init() {
                try {
                    const response = await fetch("/api/tasks");
                    const data = await response.json();
                    this.tasks = Object.entries(data).map(([name, task]) => ({
                        ...task,
                        name: name
                    }));
                } catch (error) {
                    console.error('Error fetching tasks:', error);
                    showToast('Error loading tasks', 'error');
                }
            }
        }
    }
</script>
{% endblock %}